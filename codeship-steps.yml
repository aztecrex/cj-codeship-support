- type: serial
  steps:
    - service: bash
      command: /bin/true
    - type: parallel
      steps:
        - type: serial
          steps:
            - service: git_base
              command: entrypoint.git-base git version
            - service: git_cli
              command: version
        - type: serial
          steps:
            - service: aws_base
              command: aws --version
            - type: parallel
              steps:
                - service: aws_ecs_deploy
                  command: /bin/true
                - service: aws_ecs_run
                  command: /bin/true
                - service: aws_s3_deploy
                  command: /bin/true
                - service: aws_cli
                  command: --version
                - service: aws_docker
                  command: /bin/true

- type: parallel
  tag: master
  encrypted_dockercfg_path: dockercfg.encrypted
  steps:
    - type: push
      service: aws_base
      image_name: cjengineering/codeship-aws-base
      image_tag: latest
      registry: &REGISTRY https://index.docker.io/v1/
    - type: push
      service: aws_cli
      image_name: cjengineering/codeship-aws-cli
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: aws_ecs_deploy
      image_name: cjengineering/codeship-aws-ecs-deploy
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: aws_ecs_run
      image_name: cjengineering/codeship-aws-ecs-run
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: aws_s3_deploy
      image_name: cjengineering/codeship-aws-s3-deploy
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: git_base
      image_name: cjengineering/codeship-git-base
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: git_cli
      image_name: cjengineering/codeship-git-cli
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: aws_docker
      image_name: cjengineering/codeship-aws-docker
      image_tag: latest
      registry: *REGISTRY
    - type: push
      service: bash
      image_name: cjengineering/codeship-bash
      image_tag: latest
      registry: *REGISTRY
