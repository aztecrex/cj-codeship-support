#!/bin/bash

set -e

if [ -n "$GIT_SSH_KEY" ]; then
  mkdir -p "$HOME/.ssh"
  echo -e $GIT_SSH_KEY >> $HOME/.ssh/id_rsa
  chmod 600 $HOME/.ssh/id_rsa
fi

ssh -t -o "StrictHostKeyChecking no" github.com || /bin/true


if [ "$1" = "" ]; then
  cat << EOT >&2
Runs git with supplied arguments.

Special argument "sh" drops you in a shell.

EOT
  git version >&2
elif [ "$1" = "sh" ]; then
  exec /bin/bash
else
  GIT_TRACE=1 git "$@"
  status=$?
fi
